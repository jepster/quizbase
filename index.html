<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuizMaster: Fun Quizzes for Your Spare Time!</title>
    <script src="https://cdn.socket.io/4.3.2/socket.io.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body>
<div class="h-screen bg-gray-100 flex justify-center items-center">
    <div class="bg-white w-11/12 md:w-3/4 lg:w-1/2 xl:w-1/3 p-6 rounded-lg shadow-lg">
        <div id="category-selected" class="hidden"></div>
        <div id="category-subheadline" class="hidden"></div>
        <div id="difficulty-subheadline" class="hidden"></div>
        <div id="room-creation">
            <h2 class="text-2xl font-bold mb-4">Join the Fun!</h2>
            <button class="bg-pink-500 hover:bg-pink-700 text-white font-bold py-2 px-4 rounded" onclick="createRoom()">Create a Quirky Room</button>
            <input id="room-id" class="w-full p-2 mt-2 mb-2 border-2 border-pink-500 rounded" placeholder="Enter Quirky Room ID">
            <input id="player-name" class="w-full p-2 mt-2 mb-2 border-2 border-pink-500 rounded" placeholder="Your Funky Nickname">
            <button class="bg-pink-500 hover:bg-pink-700 text-white font-bold py-2 px-4 rounded" onclick="joinRoom()">Join the Party!</button>
        </div>
        <div id="waiting-room" class="hidden">
            <h2 class="text-2xl font-bold mb-4">Waiting Room</h2>
            <h3 id="room-id-display" class="text-xl font-bold mb-2"></h3>
            <ul id="player-list" class="list-none p-0"></ul>
            <button class="bg-pink-500 hover:bg-pink-700 text-white font-bold py-2 px-4 rounded" onclick="playerReady()">I'm Ready to Rock!</button>
        </div>
        <div id="category-selection" class="hidden">
            <h2 class="text-2xl font-bold mb-4">Select a Category</h2>
            <p id="category-selector" class="text-xl font-bold mb-2"></p>
            <div id="category-buttons" class="flex flex-wrap justify-center"></div>
        </div>
        <div id="difficulty-selection" class="hidden">
            <h2 class="text-2xl font-bold mb-4">Select a Difficulty</h2>
            <p id="difficulty-selector" class="text-xl font-bold mb-2"></p>
            <div id="difficulty-buttons" class="flex flex-wrap justify-center"></div>
        </div>
        <div id="category-waiting" class="hidden">
            <h2 class="text-2xl font-bold mb-4">Waiting for Category Selection</h2>
            <p id="category-waiting-message" class="text-xl font-bold mb-2"></p>
        </div>
        <div id="game" class="hidden">
            <h2 id="question" class="text-2xl font-bold mb-4"></h2>
            <div id="options" class="flex flex-wrap justify-center"></div>
            <div id="answer-status" class="text-xl font-bold mb-2"></div>
            <div id="wrong-answer" class="hidden text-xl font-bold mb-2 bg-red-500 text-white p-4 rounded-lg"></div>
            <div id="answer-reveal" class="hidden text-xl font-bold mb-2 bg-green-500 text-white p-4 rounded-lg"></div>
            <div id="leaderboard" class="text-xl font-bold mb-2"></div>
            <button id="next-question" class="hidden bg-pink-500 hover:bg-pink-700 text-white font-bold py-2 px-4 rounded" onclick="readyForNextQuestion()">Next Question</button>
        </div>
        <div id="results" class="hidden">
            <h2 class="text-2xl font-bold mb-4">Game Results</h2>
            <div id="final-leaderboard" class="text-xl font-bold mb-2"></div>
            <div id="final-results" class="text-xl font-bold mb-2"></div>
            <button class="bg-pink-500 hover:bg-pink-700 text-white font-bold py-2 px-4 rounded" onclick="startNewGame()">Start Another Crazy Game!</button>
        </div>
    </div>
</div>

<script>
    const socket = io('http://localhost:3000');
    let currentRoom = '';
    let currentPlayer = '';
    let lastSubmittedAnswer = null;
    let currentCategory = '';
    let difficulty = '';

    function createRoom() {
        socket.emit('createRoom', (roomId) => {
            currentRoom = roomId;
            document.getElementById('room-id').value = roomId;
        });
    }

    function joinRoom() {
        const roomId = document.getElementById('room-id').value;
        const playerName = document.getElementById('player-name').value;
        currentPlayer = playerName;
        socket.emit('joinRoom', { roomId, playerName });
        currentRoom = roomId;
        document.getElementById('room-creation').classList.add('hidden');
        document.getElementById('waiting-room').classList.remove('hidden');
    }

    function playerReady() {
        socket.emit('playerReady', currentRoom);
    }

    function submitAnswer(index) {
        lastSubmittedAnswer = index;
        socket.emit('submitAnswer', { roomId: currentRoom, answerIndex: index });
        document.getElementById('answer-status').textContent = 'Answer submitted. Waiting for other players...';
        document.getElementById('options').innerHTML = '';
    }

    function readyForNextQuestion() {
        socket.emit('readyForNextQuestion', currentRoom);
        document.getElementById('next-question').classList.add('hidden');
    }

    function startNewGame() {
        socket.emit('startNewGame', currentRoom);
    }

    function selectCategory(categoryName) {
        socket.emit('categorySelected', { roomId: currentRoom, categoryName });
        document.getElementById('category-selection').classList.add('hidden');
    }

    function selectDifficulty(difficulty) {
        socket.emit('difficultySelected', { roomId: currentRoom, difficulty: difficulty });
        document.getElementById('difficulty-selection').classList.add('hidden');
    }

    socket.on('playerJoined', (data) => {
        updatePlayerList(data.players);
        document.getElementById('room-id-display').textContent = `Quirky Room: ${data.roomId}`;
    });

    socket.on('playerReady', (players) => {
        updatePlayerList(players);
    });

    socket.on('selectCategory', (data) => {
        document.getElementById('waiting-room').classList.add('hidden');
        if (data.playerName === currentPlayer) {
            document.getElementById('category-selection').classList.remove('hidden');
            document.getElementById('category-selector').textContent = `${data.playerName}, select a category:`;
            const categoryButtons = document.getElementById('category-buttons');
            categoryButtons.innerHTML = data.categories.map(category =>
                `<button class="category-button" onclick="selectCategory('${category.name}')">${category.name}</button>`
            ).join('');
        } else {
            document.getElementById('category-waiting').classList.remove('hidden');
            document.getElementById('category-waiting-message').textContent = `${data.playerName} is selecting a game category.`;
        }
    });

    socket.on('categorySelected', (data) => {
        document.getElementById('category-selection').classList.add('hidden');
        document.getElementById('category-waiting').classList.add('hidden');
        currentCategory = data.categoryName;
        difficulty = data.difficulty;
        const categorySelectedDiv = document.getElementById('category-selected');
        categorySelectedDiv.innerHTML = `
                <h3>🎉 Category Selected! 🎉</h3>
                <p>Get ready for some awesome ${data.categoryName} questions!</p>
            `;
        categorySelectedDiv.classList.remove('hidden');
        updateCategorySubheadline();
        setTimeout(() => {
            categorySelectedDiv.classList.add('hidden');
        }, 3000);
    });

    socket.on('selectDifficulty', (data) => {
        document.getElementById('category-selection').classList.add('hidden');
        if (data.playerName === currentPlayer) {
            document.getElementById('difficulty-selection').classList.remove('hidden');
            document.getElementById('difficulty-selector').textContent = `${data.playerName}, select a difficulty:`;
            const difficultyButtons = document.getElementById('difficulty-buttons');
            difficultyButtons.innerHTML = `
                    <button class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded" onclick="selectDifficulty('high')">High</button>
                    <button class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded" onclick="selectDifficulty('low')">Low</button>
                `;
        } else {
            document.getElementById('category-waiting').classList.remove('hidden');
            document.getElementById('category-waiting-message').textContent = `${data.playerName} is selecting a difficulty.`;
        }
    });

    socket.on('newQuestion', (data) => {
        document.getElementById('category-selection').classList.add('hidden');
        document.getElementById('category-waiting').classList.add('hidden');
        document.getElementById('category-selected').classList.add('hidden');
        document.getElementById('game').classList.remove('hidden');
        document.getElementById('question').textContent = data.question;
        const optionsDiv = document.getElementById('options');
        optionsDiv.innerHTML = data.options.map((option, index) =>
            `<button class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded" onclick="submitAnswer(${index})">${option}</button>`
        ).join('');
        document.getElementById('answer-status').textContent = '';
        document.getElementById('answer-reveal').classList.add('hidden');
        document.getElementById('wrong-answer').classList.add('hidden');
        document.getElementById('next-question').classList.add('hidden');
        lastSubmittedAnswer = null;
    });

    socket.on('answerRevealed', (data) => {
        const answerRevealDiv = document.getElementById('answer-reveal');
        answerRevealDiv.innerHTML = `
                <h3>Correct Answer: ${data.options[data.correctIndex]}</h3>
                <p>Explanation: ${data.explanation}</p>
            `;
        answerRevealDiv.classList.remove('hidden');

        if (lastSubmittedAnswer !== null && lastSubmittedAnswer !== data.correctIndex) {
            const wrongAnswerDiv = document.getElementById('wrong-answer');
            const funnyMessages = [
                "Oopsie-daisy! That answer was as wrong as putting pineapple on pizza!",
                "Holy guacamole! Your answer was so off, it's probably vacationing in Narnia!",
                "Yikes! That answer was more off-target than a blindfolded archer!",
                "Oh snap! Your answer just took a wrong turn at Albuquerque!",
                "Great Scott! Your answer was more mixed up than a chameleon in a bag of Skittles!"
            ];
            const randomMessage = funnyMessages[Math.floor(Math.random() * funnyMessages.length)];
            wrongAnswerDiv.textContent = randomMessage;
            wrongAnswerDiv.classList.remove('hidden');
        }

        updateLeaderboard(data.leaderboard);
        document.getElementById('next-question').classList.remove('hidden');
    });

    socket.on('gameEnded', (data) => {
        document.getElementById('game').classList.add('hidden');
        document.getElementById('results').classList.remove('hidden');
        updateFinalLeaderboard(data.leaderboard);
        const resultsDiv = document.getElementById('final-results');
        resultsDiv.innerHTML = data.results.map(q =>
            `<div>
                    <h4>${q.question}</h4>
                    <p>Correct Answer: ${q.options[q.correctIndex]}</p>
                    <p>Explanation: ${q.explanation}</p>
                </div>`
        ).join('');
    });

    socket.on('newGameStarted', (players) => {
        document.getElementById('results').classList.add('hidden');
        document.getElementById('waiting-room').classList.remove('hidden');
        updatePlayerList(players);
    });

    function updatePlayerList(players) {
        const playerList = document.getElementById('player-list');
        playerList.innerHTML = players.map(p =>
            `<li class="bg-orange-100 p-2 mt-2 mb-2 rounded-lg">${p.name} ${p.ready ? '✔️ (Ready to Rock!)' : ''}</li>`
        ).join('');
    }

    function updateLeaderboard(leaderboard) {
        const leaderboardDiv = document.getElementById('leaderboard');
        const sortedLeaderboard = leaderboard.sort((a, b) => b.score - a.score);
        leaderboardDiv.innerHTML = '<h3>Leaderboard of Legends</h3>' +
            sortedLeaderboard.map(p => `<p>${p.name}: ${p.score} points</p>`).join('');
    }

    function updateFinalLeaderboard(leaderboard) {
        const finalLeaderboardDiv = document.getElementById('final-leaderboard');
        const sortedLeaderboard = leaderboard.sort((a, b) => b.score - a.score);
        const winner = sortedLeaderboard[0];
        finalLeaderboardDiv.innerHTML = `
                <h3>Final Leaderboard</h3>
                <p class="winner">🏆 Winner: ${winner.name} with ${winner.score} points! 🏆</p>
                ${sortedLeaderboard.slice(1).map(p => `<p>${p.name}: ${p.score} points</p>`).join('')}
            `;
    }

    function updateCategorySubheadline() {
        const subheadline = document.getElementById('category-subheadline');
        subheadline.textContent = `Category: ${currentCategory}`;
        subheadline.classList.remove('hidden');

        const difficultySubheadline = document.getElementById('difficulty-subheadline');
        difficultySubheadline.textContent = `Difficulty: ${difficulty}`;
        difficultySubheadline.classList.remove('hidden');
    }
</script>
</body>
</html>
